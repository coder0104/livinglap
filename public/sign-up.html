<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>회원가입</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      @media (max-width: 992px) {
        .userwrapper {
          margin-top: 0.9rem !important;
          margin-left: 1.5rem !important;
        }
        .navbar-brand {
          text-align: center !important;
          width: 80%;
          margin: 0 auto;
        }
      }
    </style>
  </head>
  <body style="font-family: 'Do Hyeon', sans-serif">
    <section class="preloader">
      <div class="spinner">
        <span class="sk-inner-circle"></span>
      </div>
    </section>

    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
      crossorigin="anonymous"
    ></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-database.js"></script>
    <main>

      <nav class="navbar navbar-expand-lg">
        <div class="container">

          <a class="navbar-brand" href="index.html">
            <strong class="fs-2">폐의약품 처리</strong>
          </a>

            
      </nav>
      <section class="sign-in-form section-padding">
        <div class="container" style="margin-top: 4rem;">
          <div class="row">
            <div class="col-lg-8 mx-auto col-12">
              <h1 class="hero-title text-center mb-5">회원가입</h1>

              <div class="row">
                <div class="col-lg-8 col-11 mx-auto">
                  <form role="form" method="post">
                    <div class="form-floating">
                      <input
                        type="email"
                        name="email"
                        id="email"
                        class="form-control"
                        placeholder="Email address"
                      />

                      <label for="email">이메일</label>
                    </div>

                    <div class="form-floating my-4">
                      <input
                        type="text"
                        name="text"
                        id="id"
                        class="form-control"
                        placeholder="이름"
                      />

                      <label for="text">이름</label>
                    </div>

                    <div class="form-floating my-4">
                      <input
                        type="password"
                        name="password"
                        id="password"
                        class="form-control"
                        placeholder="Password"
                      />

                      <label for="password">비밀번호</label>
                    </div>

                    <div class="form-floating">
                      <input
                        type="password"
                        name="confirm_password"
                        id="confirm_password"
                        class="form-control"
                        placeholder="Password"
                      />

                      <label for="confirm_password">비밀번호 확인</label>
                    </div>

                    <div id="wrongtxtwrap" class="form-floating mt-3"></div>

                    <button
                      type="button"
                      id="registersubmit"
                      class="btn custom-btn form-control mt-4 mb-3"
                    >
                      계정 만들기
                    </button>

                    <p class="text-center">
                      이미 계정이 있으신가요? <a href="sign-in.html">로그인</a>
                    </p>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-10 me-auto mb-4">
            <h4 class="text-white mb-3"><a href="index.html">폐의약품</a></h4>
          </div>

          <div class="col-lg-5 col-8">
            <h5 class="text-white mb-3">사이트맵</h5>

            <ul class="footer-menu d-flex flex-wrap">
              <li class="footer-menu-item">
                <a href="#" class="footer-menu-link">제품</a>
              </li>

              <li class="footer-menu-item">
                <a href="#" class="footer-menu-link">개인정보 정책</a>
              </li>

              <li class="footer-menu-item">
                <a href="#" class="footer-menu-link">FAQ</a>
              </li>
            </ul>
          </div>

          <div class="col-lg-3 col-4">
            <h5 class="text-white mb-3">소셜</h5>

            <ul class="social-icon">
              <li><a href="#" class="social-icon-link bi-youtube"></a></li>

              <li><a href="#" class="social-icon-link bi-instagram"></a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyCg0Cl6lIajKPUXgnZKCcF6eok8vzXkJ_E",
        authDomain: "livinlap.firebaseapp.com",
        databaseURL: "https://livinlap-default-rtdb.firebaseio.com",
        projectId: "livinlap",
        storageBucket: "livinlap.appspot.com",
        messagingSenderId: "572384266053",
        appId: "1:572384266053:web:d205255bcb05fcf578602c",
        measurementId: "G-K1F81N4YET",
      };
      firebase.initializeApp(firebaseConfig);

      // Firebase Authentication 및 Realtime Database 가져오기
      const auth = firebase.auth();
      const database = firebase.database();

      // 회원가입 및 이메일 인증
      document
        .getElementById("registersubmit")
        .addEventListener("click", function (event) {
          event.preventDefault(); // 폼의 기본 제출 동작 방지

          const 이메일 = document.getElementById("email").value;
          const 패스워드 = document.getElementById("password").value;
          const 확인패스워드 =
            document.getElementById("confirm_password").value;
          const 이름 = document.getElementById("id").value;
          const wrongtext = `<h5 style="color: red;">비밀번호가 일치하지 않습니다</h5>`;

          if (패스워드 === 확인패스워드) {
            auth
              .createUserWithEmailAndPassword(이메일, 패스워드)
              .then((userCredential) => {
                const user = userCredential.user;

                return user.sendEmailVerification().then(() => {
                  console.log("인증 이메일이 발송되었습니다.");
                  alert(
                    "회원가입이 완료되었습니다. 꼭 이메일을 확인하여 인증해 주세요."
                  );
                  checkEmailVerification(user, 이름);
                });
              })
              .catch((error) => {
                console.error("오류:", error.message);
              });
          } else {
            document.getElementById("wrongtxtwrap").innerHTML = wrongtext;
          }
        });

      // 이메일 인증 확인 및 사용자 데이터 저장
      function checkEmailVerification(user, 이름) {
        user.reload().then(() => {
          const userRef = database.ref("users/" + user.uid); // 사용자 데이터 저장 경로
          userRef
            .set({
              email: user.email,
              name: 이름,
            })
            .then(() => {
              console.log(
                "사용자 데이터가 Realtime Database에 저장되었습니다."
              );
              location.href = 'index.html'
            })
            .catch((error) => {
              console.error("데이터 저장 오류:", error.message);
            });
        });
      }

      // function checkEmailVerification(user) {
      //     var checkInterval = setInterval(function() {
      //         user.reload().then(() => {
      //             if (user.emailVerified) {
      //                 clearInterval(checkInterval);
      //                 alert("이메일 인증이 완료되었습니다.");
      //                 // 인증 완료 후 페이지를 이동할 수 있습니다.
      //                 location.href = "index.html";
      //             }
      //         }).catch((error) => {
      //             console.error("오류:", error.message);
      //         });
      //     }, 3000); // 3초마다 인증 상태를 확인합니다.
      // }
    </script>
  </body>
</html>
